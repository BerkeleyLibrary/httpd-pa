<VirtualHost *:80>
  ServerName preservationassets.berkeley.edu
  ServerAlias preservationassets.lib.berkeley.edu
  ServerAdmin webman@library.berkeley.edu

  DocumentRoot /srv/pa_symlinks

  LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" proxy
  SetEnvIf X-Forwarded-For "^.*\..*\..*\..*" forwarded

  #CustomLog "/var/log/httpd/access-80.fwd" combined env=!forwarded
  CustomLog "logs/access-80.prx" proxy env=forwarded

  LogFormat "%{Host}i %{remoteip-proxy-ip-list}n %{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" host
  CustomLog "logs/access-80.squidHost" host

  LogFormat "%a %{Host}i %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" preservationassets
  CustomLog "logs/preservationassets.log" preservationassets

  # NOTE(dcschmidt): Indexing-related options are in ./autoindex.conf.
  # NOTE(dcschmidt): Implements custom styles. This depends on settings in
  # autoindex.conf that alias and allow the .html/ directory.
  #
  # @see http://preservationassets.berkeley.edu/ealtw/ucb/images/ Test Case
  # @see https://git.lib.berkeley.edu/lap/digital-preservation-assets/issues/1
  IndexHeadInsert "<meta name=\"viewport\" content=\"width=device-width\">"
  IndexHeadInsert "<link rel=\"stylesheet\" href=\"https://use.typekit.net/rxa5jay.css\">"
  IndexStyleSheet /.html/css/style.css
  ReadmeName /.html/partials/footer.html
  HeaderName /.html/partials/header.html

  # NOTE(dcschmidt): Adds Google Analytics tracking code. The tracker ID is
  # different between PA/DA.
  # @see https://ucblib.atlassian.net/browse/DEV-199
  IndexHeadInsert "<!-- Google tag (gtag.js) --> \
  <script async src='https://www.googletagmanager.com/gtag/js?id=G-1BDXMND6GT'></script> \
  <script> \
    window.dataLayer = window.dataLayer || []; \
    function gtag(){dataLayer.push(arguments);} \
    gtag('js', new Date()); \
    gtag('config', 'G-1BDXMND6GT'); \
  </script>"

  <Directory /srv/pa_symlinks>
    Options All
    AllowOverride All

    <RequireAll>
      Require not env UCBonlyDenyFrom

      <RequireAny>
        Require env UCBonlyAllowFrom

        Require host \
          alapay.ucop.edu \
          ingest01-stg.cdlib.org \
          ingest02-stg.cdlib.org \
          ucblibrary5.berkeley.edu

        # Lynne's processing station
        # @see https://jira-secure.berkeley.edu/browse/LIT-2036
        Require ip 169.229.203.66
        Require ip 169.229.203.71

        Require ip \
          128.32.113.163 \
          128.32.113.164 \
          128.32.169.72 \
          128.32.17.34 \
          128.32.17.38 \
          128.32.17.42 \
          128.32.99.168 \
          128.32.99.245 \
          128.48.116.112 \
          128.48.120 \
          164.67.152.108 \
          169.229.137.69 \
          169.229.138.110 \
          169.229.138.111 \
          192.35.209 \
          192.35.209.153

        # Added 2015/05/11 per CDL request
        Require ip \
          54.244.52.10 \
          54.244.52.117 \
          54.244.52.124 \
          54.244.52.125 \
          54.244.52.126 \
          54.244.52.40 \
          54.244.52.49 \
          54.244.52.50

        # The following for Elliot Smith
        Require ip \
          128.32.146.32 \
          128.32.146.34 \
          169.229.202.143
        Require host \
          dp08.cdlib.org \
          ferret.cdlib.org \
          ingest01.cdlib.org \
          ingest02.cdlib.org \
          ingest03.cdlib.org

        # Hathitrust Harvesting
        # @see https://jira-secure.berkeley.edu/browse/LIT-218
        Require ip 141.213.128.128/25

        # Penn Harvesting
        # @see https://jira-secure.berkeley.edu/browse/LIT-2767
        Require ip \
          130.91.118.198 \
          165.123.34.158
      </RequireAny>
    </RequireAll>
  </Directory>

  ErrorDocument 403 http://www.lib.berkeley.edu/errors/forbidden.html
</VirtualHost>
